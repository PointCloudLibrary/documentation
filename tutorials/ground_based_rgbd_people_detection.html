<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Detecting people on a ground plane with RGB-D data &mdash; Point Cloud Library 1.14.1-dev documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Point Cloud Library
          </a>
              <div class="version">
                1.14.1-dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Detecting people on a ground plane with RGB-D data</a></li>
<li><a class="reference internal" href="#the-code">The code</a></li>
<li><a class="reference internal" href="#the-explanation">The explanation</a><ul>
<li><a class="reference internal" href="#main">Main:</a></li>
<li><a class="reference internal" href="#ground-initialization">Ground initialization:</a></li>
<li><a class="reference internal" href="#main-loop">Main loop:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#compiling-and-running-the-program">Compiling and running the program</a></li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Point Cloud Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Detecting people on a ground plane with RGB-D data</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="detecting-people-on-a-ground-plane-with-rgb-d-data">
<span id="ground-based-rgbd-people-detection"></span><h1>Detecting people on a ground plane with RGB-D data</h1>
<p>This tutorial aims at explaining how to detect people from RGB-D data with the pcl_people module.
With the proposed method, people standing/walking on a planar ground plane can be detected in real time with standard CPU computation.
This implementation corresponds to the people detection algorithm for RGB-D data presented in</p>
<ul class="simple">
<li><p><em>M. Munaro and E. Menegatti</em>. “Fast RGB-D people tracking for service robots”. In Autonomous Robots, Volume 37 Issue 3, pp. 227-242, Springer, 2014.</p></li>
<li><p><em>M. Munaro, F. Basso and E. Menegatti</em>. “Tracking people within groups with RGB-D data”. In Proceedings of the International Conference on Intelligent Robots and Systems (IROS) 2012, Vilamoura (Portugal), 2012.</p></li>
</ul>
</section>
<section id="the-code">
<h1>The code</h1>
<p>You can download the source code for this tutorial from <a class="reference download internal" download="" href="_downloads/7a1ca7a2a1a8c5702d70b2400876b008/main_ground_based_people_detection.cpp"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>,
while the file containing the needed SVM parameters can be found <a class="reference download internal" download="" href="_downloads/a5117b2b00958c644b1bb0d2d8f4dd95/trainedLinearSVMForPeopleDetectionWithHOG.yaml"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>.
We implemented a people detection demo from a live RGB-D stream obtained with an OpenNI-compatible sensor (Microsoft Kinect, Asus Xtion, etc.).</p>
<p>Here it is the code:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/console/parse.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/point_types.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/visualization/pcl_visualizer.h&gt;</span><span class="c1">    </span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/io/openni_grabber.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/sample_consensus/sac_model_plane.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/people/ground_based_people_detection_app.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/common/time.h&gt;</span><span class="cp"></span>


<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mutex&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thread&gt;</span><span class="cp"></span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="o">::</span><span class="nn">chrono_literals</span><span class="p">;</span><span class="w"></span>

<span class="k">typedef</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZRGBA</span><span class="w"> </span><span class="n">PointT</span><span class="p">;</span><span class="w"></span>
<span class="k">typedef</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">PointT</span><span class="o">&gt;</span><span class="w"> </span><span class="n">PointCloudT</span><span class="p">;</span><span class="w"></span>

<span class="c1">// PCL viewer //</span>
<span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PCLVisualizer</span><span class="w"> </span><span class="nf">viewer</span><span class="p">(</span><span class="s">&quot;PCL Viewer&quot;</span><span class="p">);</span><span class="w"></span>

<span class="c1">// Mutex: //</span>
<span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">cloud_mutex</span><span class="p">;</span><span class="w"></span>

<span class="k">enum</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">COLS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w"> </span><span class="n">ROWS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">480</span><span class="w"> </span><span class="p">};</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">print_help</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;*******************************************************&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Ground based people detection app options:&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;   --help    &lt;show_this_help&gt;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;   --svm     &lt;path_to_svm_file&gt;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;   --conf    &lt;minimum_HOG_confidence (default = -1.5)&gt;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;   --min_h   &lt;minimum_person_height (default = 1.3)&gt;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;   --max_h   &lt;maximum_person_height (default = 2.3)&gt;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;*******************************************************&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">cloud_cb_</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">PointCloudT</span><span class="o">::</span><span class="n">ConstPtr</span><span class="w"> </span><span class="o">&amp;</span><span class="n">callback_cloud</span><span class="p">,</span><span class="w"> </span><span class="n">PointCloudT</span><span class="o">::</span><span class="n">Ptr</span><span class="o">&amp;</span><span class="w"> </span><span class="n">cloud</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="o">*</span><span class="w"> </span><span class="n">new_cloud_available_flag</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">cloud_mutex</span><span class="p">.</span><span class="n">lock</span><span class="w"> </span><span class="p">();</span><span class="w">    </span><span class="c1">// for not overwriting the point cloud from another thread</span>
<span class="w">  </span><span class="o">*</span><span class="n">cloud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">callback_cloud</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="o">*</span><span class="n">new_cloud_available_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">cloud_mutex</span><span class="p">.</span><span class="n">unlock</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">struct</span><span class="w"> </span><span class="nc">callback_args</span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// structure used to pass arguments to the callback function</span>
<span class="w">  </span><span class="n">PointCloudT</span><span class="o">::</span><span class="n">Ptr</span><span class="w"> </span><span class="n">clicked_points_3d</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PCLVisualizer</span><span class="o">::</span><span class="n">Ptr</span><span class="w"> </span><span class="n">viewerPtr</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
<span class="w">  </span>
<span class="kt">void</span><span class="w"></span>
<span class="nf">pp_callback</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PointPickingEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">callback_args</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">callback_args</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">args</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">getPointIndex</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">PointT</span><span class="w"> </span><span class="n">current_point</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">event</span><span class="p">.</span><span class="n">getPoint</span><span class="p">(</span><span class="n">current_point</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">current_point</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">current_point</span><span class="p">.</span><span class="n">z</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">data</span><span class="o">-&gt;</span><span class="n">clicked_points_3d</span><span class="o">-&gt;</span><span class="n">points</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">current_point</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Draw clicked points in red:</span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PointCloudColorHandlerCustom</span><span class="o">&lt;</span><span class="n">PointT</span><span class="o">&gt;</span><span class="w"> </span><span class="n">red</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">clicked_points_3d</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">data</span><span class="o">-&gt;</span><span class="n">viewerPtr</span><span class="o">-&gt;</span><span class="n">removePointCloud</span><span class="p">(</span><span class="s">&quot;clicked_points&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">data</span><span class="o">-&gt;</span><span class="n">viewerPtr</span><span class="o">-&gt;</span><span class="n">addPointCloud</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">clicked_points_3d</span><span class="p">,</span><span class="w"> </span><span class="n">red</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;clicked_points&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">data</span><span class="o">-&gt;</span><span class="n">viewerPtr</span><span class="o">-&gt;</span><span class="n">setPointCloudRenderingProperties</span><span class="p">(</span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PCL_VISUALIZER_POINT_SIZE</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;clicked_points&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">current_point</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">current_point</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">current_point</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">find_switch</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;--help&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">find_switch</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-h&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">print_help</span><span class="p">();</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Algorithm parameters:</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">svm_filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;../../people/data/trainedLinearSVMForPeopleDetectionWithHOG.yaml&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">min_confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.5</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">min_height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.3</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">max_height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.3</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">voxel_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.06</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3f</span><span class="w"> </span><span class="n">rgb_intrinsics_matrix</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">rgb_intrinsics_matrix</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">525</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">319.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mi">525</span><span class="p">,</span><span class="w"> </span><span class="mf">239.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Kinect RGB camera intrinsics</span>

<span class="w">  </span><span class="c1">// Read if some parameters are passed from command line:</span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">parse_argument</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;--svm&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">svm_filename</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">parse_argument</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;--conf&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">min_confidence</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">parse_argument</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;--min_h&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">min_height</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">parse_argument</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;--max_h&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">max_height</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Read Kinect live stream:</span>
<span class="w">  </span><span class="n">PointCloudT</span><span class="o">::</span><span class="n">Ptr</span><span class="w"> </span><span class="n">cloud</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">PointCloudT</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">new_cloud_available_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">Grabber</span><span class="o">*</span><span class="w"> </span><span class="n">interface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">OpenNIGrabber</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZRGBA</span><span class="o">&gt;::</span><span class="n">ConstPtr</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZRGBA</span><span class="o">&gt;::</span><span class="n">ConstPtr</span><span class="o">&amp;</span><span class="w"> </span><span class="n">callback_cloud</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cloud_cb_</span><span class="w"> </span><span class="p">(</span><span class="n">callback_cloud</span><span class="p">,</span><span class="w"> </span><span class="n">cloud</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">new_cloud_available_flag</span><span class="p">);</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">  </span><span class="n">interface</span><span class="o">-&gt;</span><span class="n">registerCallback</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">interface</span><span class="o">-&gt;</span><span class="n">start</span><span class="w"> </span><span class="p">();</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Wait for the first frame:</span>
<span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">new_cloud_available_flag</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="mi">1</span><span class="n">ms</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">new_cloud_available_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">cloud_mutex</span><span class="p">.</span><span class="n">lock</span><span class="w"> </span><span class="p">();</span><span class="w">    </span><span class="c1">// for not overwriting the point cloud</span>

<span class="w">  </span><span class="c1">// Display pointcloud:</span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PointCloudColorHandlerRGBField</span><span class="o">&lt;</span><span class="n">PointT</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rgb</span><span class="p">(</span><span class="n">cloud</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">viewer</span><span class="p">.</span><span class="n">addPointCloud</span><span class="o">&lt;</span><span class="n">PointT</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span><span class="w"> </span><span class="n">rgb</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;input_cloud&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">viewer</span><span class="p">.</span><span class="n">setCameraPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">-2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">-1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Add point picking callback to viewer:</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">callback_args</span><span class="w"> </span><span class="n">cb_args</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">PointCloudT</span><span class="o">::</span><span class="n">Ptr</span><span class="w"> </span><span class="n">clicked_points_3d</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">PointCloudT</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">cb_args</span><span class="p">.</span><span class="n">clicked_points_3d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clicked_points_3d</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">cb_args</span><span class="p">.</span><span class="n">viewerPtr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PCLVisualizer</span><span class="o">::</span><span class="n">Ptr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">viewer</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">viewer</span><span class="p">.</span><span class="n">registerPointPickingCallback</span><span class="w"> </span><span class="p">(</span><span class="n">pp_callback</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">cb_args</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Shift+click on three floor points, then press &#39;Q&#39;...&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Spin until &#39;Q&#39; is pressed:</span>
<span class="w">  </span><span class="n">viewer</span><span class="p">.</span><span class="n">spin</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;done.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span>
<span class="w">  </span><span class="n">cloud_mutex</span><span class="p">.</span><span class="n">unlock</span><span class="w"> </span><span class="p">();</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Ground plane estimation:</span>
<span class="w">  </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXf</span><span class="w"> </span><span class="n">ground_coeffs</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">ground_coeffs</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">clicked_points_indices</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">clicked_points_3d</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">clicked_points_indices</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">SampleConsensusModelPlane</span><span class="o">&lt;</span><span class="n">PointT</span><span class="o">&gt;</span><span class="w"> </span><span class="n">model_plane</span><span class="p">(</span><span class="n">clicked_points_3d</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">model_plane</span><span class="p">.</span><span class="n">computeModelCoefficients</span><span class="p">(</span><span class="n">clicked_points_indices</span><span class="p">,</span><span class="n">ground_coeffs</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Ground plane: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ground_coeffs</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ground_coeffs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ground_coeffs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ground_coeffs</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Initialize new viewer:</span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PCLVisualizer</span><span class="w"> </span><span class="n">viewer</span><span class="p">(</span><span class="s">&quot;PCL Viewer&quot;</span><span class="p">);</span><span class="w">          </span><span class="c1">// viewer initialization</span>
<span class="w">  </span><span class="n">viewer</span><span class="p">.</span><span class="n">setCameraPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">-2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">-1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Create classifier for people detection:  </span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">people</span><span class="o">::</span><span class="n">PersonClassifier</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">RGB</span><span class="o">&gt;</span><span class="w"> </span><span class="n">person_classifier</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">person_classifier</span><span class="p">.</span><span class="n">loadSVMFromFile</span><span class="p">(</span><span class="n">svm_filename</span><span class="p">);</span><span class="w">   </span><span class="c1">// load trained SVM</span>

<span class="w">  </span><span class="c1">// People detection app initialization:</span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">people</span><span class="o">::</span><span class="n">GroundBasedPeopleDetectionApp</span><span class="o">&lt;</span><span class="n">PointT</span><span class="o">&gt;</span><span class="w"> </span><span class="n">people_detector</span><span class="p">;</span><span class="w">    </span><span class="c1">// people detection object</span>
<span class="w">  </span><span class="n">people_detector</span><span class="p">.</span><span class="n">setVoxelSize</span><span class="p">(</span><span class="n">voxel_size</span><span class="p">);</span><span class="w">                        </span><span class="c1">// set the voxel size</span>
<span class="w">  </span><span class="n">people_detector</span><span class="p">.</span><span class="n">setIntrinsics</span><span class="p">(</span><span class="n">rgb_intrinsics_matrix</span><span class="p">);</span><span class="w">            </span><span class="c1">// set RGB camera intrinsic parameters</span>
<span class="w">  </span><span class="n">people_detector</span><span class="p">.</span><span class="n">setClassifier</span><span class="p">(</span><span class="n">person_classifier</span><span class="p">);</span><span class="w">                </span><span class="c1">// set person classifier</span>
<span class="w">  </span><span class="n">people_detector</span><span class="p">.</span><span class="n">setPersonClusterLimits</span><span class="p">(</span><span class="n">min_height</span><span class="p">,</span><span class="w"> </span><span class="n">max_height</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="mf">8.0</span><span class="p">);</span><span class="w">  </span><span class="c1">// set person classifier</span>
<span class="c1">//  people_detector.setSensorPortraitOrientation(true);             // set sensor orientation to vertical</span>

<span class="w">  </span><span class="c1">// For timing:</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">getTime</span><span class="w"> </span><span class="p">();</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Main loop:</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">viewer</span><span class="p">.</span><span class="n">wasStopped</span><span class="p">())</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">new_cloud_available_flag</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">cloud_mutex</span><span class="p">.</span><span class="n">try_lock</span><span class="w"> </span><span class="p">())</span><span class="w">    </span><span class="c1">// if a new cloud is available</span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">new_cloud_available_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Perform people detection on the new cloud:</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">people</span><span class="o">::</span><span class="n">PersonCluster</span><span class="o">&lt;</span><span class="n">PointT</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">clusters</span><span class="p">;</span><span class="w">   </span><span class="c1">// vector containing persons clusters</span>
<span class="w">      </span><span class="n">people_detector</span><span class="p">.</span><span class="n">setInputCloud</span><span class="p">(</span><span class="n">cloud</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">people_detector</span><span class="p">.</span><span class="n">setGround</span><span class="p">(</span><span class="n">ground_coeffs</span><span class="p">);</span><span class="w">                    </span><span class="c1">// set floor coefficients</span>
<span class="w">      </span><span class="n">people_detector</span><span class="p">.</span><span class="n">compute</span><span class="p">(</span><span class="n">clusters</span><span class="p">);</span><span class="w">                           </span><span class="c1">// perform people detection</span>

<span class="w">      </span><span class="n">ground_coeffs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">people_detector</span><span class="p">.</span><span class="n">getGround</span><span class="p">();</span><span class="w">                 </span><span class="c1">// get updated floor coefficients</span>

<span class="w">      </span><span class="c1">// Draw cloud and people bounding boxes in the viewer:</span>
<span class="w">      </span><span class="n">viewer</span><span class="p">.</span><span class="n">removeAllPointClouds</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="n">viewer</span><span class="p">.</span><span class="n">removeAllShapes</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PointCloudColorHandlerRGBField</span><span class="o">&lt;</span><span class="n">PointT</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rgb</span><span class="p">(</span><span class="n">cloud</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">viewer</span><span class="p">.</span><span class="n">addPointCloud</span><span class="o">&lt;</span><span class="n">PointT</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span><span class="w"> </span><span class="n">rgb</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;input_cloud&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">clusters</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">cluster</span><span class="p">.</span><span class="n">getPersonConfidence</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">min_confidence</span><span class="p">)</span><span class="w">             </span><span class="c1">// draw only people with confidence above a threshold</span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="c1">// draw theoretical person bounding box in the PCL viewer:</span>
<span class="w">          </span><span class="n">cluster</span><span class="p">.</span><span class="n">drawTBoundingBox</span><span class="p">(</span><span class="n">viewer</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="o">++</span><span class="n">k</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; people found&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">viewer</span><span class="p">.</span><span class="n">spinOnce</span><span class="p">();</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Display average framerate:</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">++</span><span class="n">count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">getTime</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Average framerate: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="kt">double</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">/</span><span class="kt">double</span><span class="p">(</span><span class="n">now</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">last</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; Hz&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">now</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="n">cloud_mutex</span><span class="p">.</span><span class="n">unlock</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="the-explanation">
<h1>The explanation</h1>
<p>Now, let’s break down the code piece by piece.</p>
<p>The first lines allow to print a help text showing the command line parameters that can be set when launching the executable.
No parameter is needed by default, but you can optionally set the path to the file containing the trained SVM
for people detection (<code class="docutils literal notranslate"><span class="pre">--svm</span></code>) and the minimum HOG confidence allowed (<code class="docutils literal notranslate"><span class="pre">--conf</span></code>). Moreover, the minimum (<code class="docutils literal notranslate"><span class="pre">min_h</span></code>) and
maximum (<code class="docutils literal notranslate"><span class="pre">max_h</span></code>) height of people can be set. If no parameter is set, the default values are used.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">COLS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">640</span><span class="p">,</span><span class="w"> </span><span class="n">ROWS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">480</span><span class="w"> </span><span class="p">};</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">print_help</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;*******************************************************&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Ground based people detection app options:&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;   --help    &lt;show_this_help&gt;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;   --svm     &lt;path_to_svm_file&gt;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;   --conf    &lt;minimum_HOG_confidence (default = -1.5)&gt;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;   --min_h   &lt;minimum_person_height (default = 1.3)&gt;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;   --max_h   &lt;maximum_person_height (default = 2.3)&gt;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;*******************************************************&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Here, the callback used for grabbing pointclouds with OpenNI is defined.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="n">cloud_cb_</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">PointCloudT</span><span class="o">::</span><span class="n">ConstPtr</span><span class="w"> </span><span class="o">&amp;</span><span class="n">callback_cloud</span><span class="p">,</span><span class="w"> </span><span class="n">PointCloudT</span><span class="o">::</span><span class="n">Ptr</span><span class="o">&amp;</span><span class="w"> </span><span class="n">cloud</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="o">*</span><span class="w"> </span><span class="n">new_cloud_available_flag</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">cloud_mutex</span><span class="p">.</span><span class="n">lock</span><span class="w"> </span><span class="p">();</span><span class="w">    </span><span class="c1">// for not overwriting the point cloud from another thread</span>
<span class="w">  </span><span class="o">*</span><span class="n">cloud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">callback_cloud</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="o">*</span><span class="n">new_cloud_available_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>The people detection algorithm used makes the assumption that people stand/walk on a planar ground plane.
Thus, it requires to know the equation of the ground plane in order to perform people detection.
In this tutorial, the ground plane is manually initialized by the user by selecting three floor points
from the first acquired pointcloud.
In the following lines, the callback function used for ground plane initialization is shown, together with
the structure used to pass arguments to this callback.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">}</span><span class="w"></span>

<span class="k">struct</span><span class="w"> </span><span class="nc">callback_args</span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// structure used to pass arguments to the callback function</span>
<span class="w">  </span><span class="n">PointCloudT</span><span class="o">::</span><span class="n">Ptr</span><span class="w"> </span><span class="n">clicked_points_3d</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PCLVisualizer</span><span class="o">::</span><span class="n">Ptr</span><span class="w"> </span><span class="n">viewerPtr</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
<span class="w">  </span>
<span class="kt">void</span><span class="w"></span>
<span class="nf">pp_callback</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PointPickingEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">callback_args</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">callback_args</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">args</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">getPointIndex</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">PointT</span><span class="w"> </span><span class="n">current_point</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">event</span><span class="p">.</span><span class="n">getPoint</span><span class="p">(</span><span class="n">current_point</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">current_point</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">current_point</span><span class="p">.</span><span class="n">z</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">data</span><span class="o">-&gt;</span><span class="n">clicked_points_3d</span><span class="o">-&gt;</span><span class="n">points</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">current_point</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Draw clicked points in red:</span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PointCloudColorHandlerCustom</span><span class="o">&lt;</span><span class="n">PointT</span><span class="o">&gt;</span><span class="w"> </span><span class="n">red</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">clicked_points_3d</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">data</span><span class="o">-&gt;</span><span class="n">viewerPtr</span><span class="o">-&gt;</span><span class="n">removePointCloud</span><span class="p">(</span><span class="s">&quot;clicked_points&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">data</span><span class="o">-&gt;</span><span class="n">viewerPtr</span><span class="o">-&gt;</span><span class="n">addPointCloud</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">clicked_points_3d</span><span class="p">,</span><span class="w"> </span><span class="n">red</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;clicked_points&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">data</span><span class="o">-&gt;</span><span class="n">viewerPtr</span><span class="o">-&gt;</span><span class="n">setPointCloudRenderingProperties</span><span class="p">(</span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PCL_VISUALIZER_POINT_SIZE</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;clicked_points&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<section id="main">
<h2>Main:</h2>
<p>The main program starts by initializing the main parameters and reading the command line options.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">find_switch</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;--help&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">find_switch</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-h&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">print_help</span><span class="p">();</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Algorithm parameters:</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">svm_filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;../../people/data/trainedLinearSVMForPeopleDetectionWithHOG.yaml&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">min_confidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.5</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">min_height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.3</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">max_height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.3</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">voxel_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.06</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3f</span><span class="w"> </span><span class="n">rgb_intrinsics_matrix</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">rgb_intrinsics_matrix</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">525</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">319.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mi">525</span><span class="p">,</span><span class="w"> </span><span class="mf">239.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Kinect RGB camera intrinsics</span>

<span class="w">  </span><span class="c1">// Read if some parameters are passed from command line:</span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">parse_argument</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;--svm&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">svm_filename</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">parse_argument</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;--conf&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">min_confidence</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="ground-initialization">
<h2>Ground initialization:</h2>
<p>Then, the <a class="reference external" href="https://pointclouds.org/documentation/classpcl_1_1_grabber.html">pcl::Grabber</a> object is initialized in order to acquire RGB-D pointclouds and the program waits for
the first frame.
When the first pointcloud is acquired, it is displayed in the visualizer and the user is requested to select
three floor points by pressing <code class="docutils literal notranslate"><span class="pre">shift+click</span></code> as reported in the figure below.
After this, <code class="docutils literal notranslate"><span class="pre">Q</span></code> must be pressed in order to close the visualizer and let the program continue.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">parse_argument</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;--max_h&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">max_height</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Read Kinect live stream:</span>
<span class="w">  </span><span class="n">PointCloudT</span><span class="o">::</span><span class="n">Ptr</span><span class="w"> </span><span class="nf">cloud</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">PointCloudT</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">new_cloud_available_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">Grabber</span><span class="o">*</span><span class="w"> </span><span class="n">interface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">OpenNIGrabber</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZRGBA</span><span class="o">&gt;::</span><span class="n">ConstPtr</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZRGBA</span><span class="o">&gt;::</span><span class="n">ConstPtr</span><span class="o">&amp;</span><span class="w"> </span><span class="n">callback_cloud</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cloud_cb_</span><span class="w"> </span><span class="p">(</span><span class="n">callback_cloud</span><span class="p">,</span><span class="w"> </span><span class="n">cloud</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">new_cloud_available_flag</span><span class="p">);</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">  </span><span class="n">interface</span><span class="o">-&gt;</span><span class="n">registerCallback</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">interface</span><span class="o">-&gt;</span><span class="n">start</span><span class="w"> </span><span class="p">();</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Wait for the first frame:</span>
<span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">new_cloud_available_flag</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="mi">1</span><span class="n">ms</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">new_cloud_available_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">cloud_mutex</span><span class="p">.</span><span class="n">lock</span><span class="w"> </span><span class="p">();</span><span class="w">    </span><span class="c1">// for not overwriting the point cloud</span>

<span class="w">  </span><span class="c1">// Display pointcloud:</span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PointCloudColorHandlerRGBField</span><span class="o">&lt;</span><span class="n">PointT</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rgb</span><span class="p">(</span><span class="n">cloud</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">viewer</span><span class="p">.</span><span class="n">addPointCloud</span><span class="o">&lt;</span><span class="n">PointT</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span><span class="w"> </span><span class="n">rgb</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;input_cloud&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">viewer</span><span class="p">.</span><span class="n">setCameraPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">-2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">-1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Add point picking callback to viewer:</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">callback_args</span><span class="w"> </span><span class="n">cb_args</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">PointCloudT</span><span class="o">::</span><span class="n">Ptr</span><span class="w"> </span><span class="nf">clicked_points_3d</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">PointCloudT</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">cb_args</span><span class="p">.</span><span class="n">clicked_points_3d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clicked_points_3d</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">cb_args</span><span class="p">.</span><span class="n">viewerPtr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PCLVisualizer</span><span class="o">::</span><span class="n">Ptr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">viewer</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">viewer</span><span class="p">.</span><span class="n">registerPointPickingCallback</span><span class="w"> </span><span class="p">(</span><span class="n">pp_callback</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">cb_args</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Shift+click on three floor points, then press &#39;Q&#39;...&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Spin until &#39;Q&#39; is pressed:</span>
<span class="w">  </span><span class="n">viewer</span><span class="p">.</span><span class="n">spin</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;done.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/Screen_floor.jpg"><img alt="_images/Screen_floor.jpg" class="align-center" src="_images/Screen_floor.jpg" style="height: 300pt;" /></a>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When selecting the floor points, try to click on non collinear points that are distant from each other, in order to improve
plane estimation.</p>
</div>
<p>Given the three points, the ground plane is estimated with a Sample Consensus approach and the plane coefficients are
written to the command window.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">cloud_mutex</span><span class="p">.</span><span class="n">unlock</span><span class="w"> </span><span class="p">();</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Ground plane estimation:</span>
<span class="w">  </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXf</span><span class="w"> </span><span class="n">ground_coeffs</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">ground_coeffs</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">clicked_points_indices</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">clicked_points_3d</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">clicked_points_indices</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">SampleConsensusModelPlane</span><span class="o">&lt;</span><span class="n">PointT</span><span class="o">&gt;</span><span class="w"> </span><span class="n">model_plane</span><span class="p">(</span><span class="n">clicked_points_3d</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>In the following lines, we can see the initialization of the SVM classifier by loading the pre-trained parameters
from file.
Moreover, a <a class="reference external" href="https://pointclouds.org/documentation/classpcl_1_1people_1_1_ground_based_people_detection_app.html">GroundBasedPeopleDetectionApp</a> object is declared and the main
parameters are set. In this example, we can see how to set the voxel size used for downsampling the pointcloud,
the rgb camera intrinsic parameters, the <a class="reference external" href="https://pointclouds.org/documentation/classpcl_1_1people_1_1_person_classifier.html">PersonClassifier</a> object and the height limits.
Other parameters could be set, such as the sensor orientation. If the sensor is vertically placed, the method
setSensorPortraitOrientation should be used to enable the vertical mode in <a class="reference external" href="https://pointclouds.org/documentation/classpcl_1_1people_1_1_ground_based_people_detection_app.html">GroundBasedPeopleDetectionApp</a>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">viewer</span><span class="p">.</span><span class="n">setCameraPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">-2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">-1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Create classifier for people detection:  </span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">people</span><span class="o">::</span><span class="n">PersonClassifier</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">RGB</span><span class="o">&gt;</span><span class="w"> </span><span class="n">person_classifier</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">person_classifier</span><span class="p">.</span><span class="n">loadSVMFromFile</span><span class="p">(</span><span class="n">svm_filename</span><span class="p">);</span><span class="w">   </span><span class="c1">// load trained SVM</span>

<span class="w">  </span><span class="c1">// People detection app initialization:</span>
<span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">people</span><span class="o">::</span><span class="n">GroundBasedPeopleDetectionApp</span><span class="o">&lt;</span><span class="n">PointT</span><span class="o">&gt;</span><span class="w"> </span><span class="n">people_detector</span><span class="p">;</span><span class="w">    </span><span class="c1">// people detection object</span>
<span class="w">  </span><span class="n">people_detector</span><span class="p">.</span><span class="n">setVoxelSize</span><span class="p">(</span><span class="n">voxel_size</span><span class="p">);</span><span class="w">                        </span><span class="c1">// set the voxel size</span>
<span class="w">  </span><span class="n">people_detector</span><span class="p">.</span><span class="n">setIntrinsics</span><span class="p">(</span><span class="n">rgb_intrinsics_matrix</span><span class="p">);</span><span class="w">            </span><span class="c1">// set RGB camera intrinsic parameters</span>
<span class="w">  </span><span class="n">people_detector</span><span class="p">.</span><span class="n">setClassifier</span><span class="p">(</span><span class="n">person_classifier</span><span class="p">);</span><span class="w">                </span><span class="c1">// set person classifier</span>
</pre></div>
</div>
</section>
<section id="main-loop">
<h2>Main loop:</h2>
<p>In the main loop, new frames are acquired and processed until the application is terminated by the user.
The <code class="docutils literal notranslate"><span class="pre">people_detector</span></code> object receives as input the current cloud and the estimated ground coefficients and
computes people clusters properties, which are stored in <a class="reference external" href="https://pointclouds.org/documentation/classpcl_1_1people_1_1_person_cluster.html">PersonCluster</a> objects.
The ground plane coefficients are re-estimated at every frame by using the previous frame estimate as initial condition.
This procedure allows to adapt to small changes which can occur to the ground plane equation if the camera is slowly moving.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">getTime</span><span class="w"> </span><span class="p">();</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Main loop:</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">viewer</span><span class="p">.</span><span class="n">wasStopped</span><span class="p">())</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">new_cloud_available_flag</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">cloud_mutex</span><span class="p">.</span><span class="n">try_lock</span><span class="w"> </span><span class="p">())</span><span class="w">    </span><span class="c1">// if a new cloud is available</span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">new_cloud_available_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Perform people detection on the new cloud:</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">people</span><span class="o">::</span><span class="n">PersonCluster</span><span class="o">&lt;</span><span class="n">PointT</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">clusters</span><span class="p">;</span><span class="w">   </span><span class="c1">// vector containing persons clusters</span>
<span class="w">      </span><span class="n">people_detector</span><span class="p">.</span><span class="n">setInputCloud</span><span class="p">(</span><span class="n">cloud</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">people_detector</span><span class="p">.</span><span class="n">setGround</span><span class="p">(</span><span class="n">ground_coeffs</span><span class="p">);</span><span class="w">                    </span><span class="c1">// set floor coefficients</span>
<span class="w">      </span><span class="n">people_detector</span><span class="p">.</span><span class="n">compute</span><span class="p">(</span><span class="n">clusters</span><span class="p">);</span><span class="w">                           </span><span class="c1">// perform people detection</span>
</pre></div>
</div>
<p>The last part of the code is devoted to visualization. In particular, a green 3D bounding box is drawn for every
person with HOG confidence above the <code class="docutils literal notranslate"><span class="pre">min_confidence</span></code> threshold. The width of the bounding box is fixed, while
the height is determined as the distance between the top point of the person cluster and the ground plane.
The average framerate is also shown every 30 frames, to evaluate the runtime performance of the application.
Please note that this framerate includes the time necessary for grabbing the point clouds and for visualization.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="n">ground_coeffs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">people_detector</span><span class="p">.</span><span class="n">getGround</span><span class="p">();</span><span class="w">                 </span><span class="c1">// get updated floor coefficients</span>

<span class="w">      </span><span class="c1">// Draw cloud and people bounding boxes in the viewer:</span>
<span class="w">      </span><span class="n">viewer</span><span class="p">.</span><span class="n">removeAllPointClouds</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="n">viewer</span><span class="p">.</span><span class="n">removeAllShapes</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PointCloudColorHandlerRGBField</span><span class="o">&lt;</span><span class="n">PointT</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rgb</span><span class="p">(</span><span class="n">cloud</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">viewer</span><span class="p">.</span><span class="n">addPointCloud</span><span class="o">&lt;</span><span class="n">PointT</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span><span class="w"> </span><span class="n">rgb</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;input_cloud&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">clusters</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">cluster</span><span class="p">.</span><span class="n">getPersonConfidence</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">min_confidence</span><span class="p">)</span><span class="w">             </span><span class="c1">// draw only people with confidence above a threshold</span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="c1">// draw theoretical person bounding box in the PCL viewer:</span>
<span class="w">          </span><span class="n">cluster</span><span class="p">.</span><span class="n">drawTBoundingBox</span><span class="p">(</span><span class="n">viewer</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="o">++</span><span class="n">k</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; people found&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">viewer</span><span class="p">.</span><span class="n">spinOnce</span><span class="p">();</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Display average framerate:</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">++</span><span class="n">count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">getTime</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Average framerate: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="kt">double</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">/</span><span class="kt">double</span><span class="p">(</span><span class="n">now</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">last</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; Hz&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">now</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="compiling-and-running-the-program">
<h1>Compiling and running the program</h1>
<p>Create a <cite>CMakeLists.txt</cite> file and add the following lines into it:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.5</span><span class="w"> </span><span class="s">FATAL_ERROR</span><span class="p">)</span>
<span class="linenos"> 2</span><span class="nb">project</span><span class="p">(</span><span class="s">ground_based_rgbd_people_detector</span><span class="p">)</span>
<span class="linenos"> 3</span><span class="nb">find_package</span><span class="p">(</span><span class="s">PCL</span><span class="w"> </span><span class="s">1.7</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="nb">include_directories</span><span class="p">(</span><span class="o">${</span><span class="nv">PCL_INCLUDE_DIRS</span><span class="o">}</span><span class="p">)</span>
<span class="linenos"> 6</span><span class="nb">link_directories</span><span class="p">(</span><span class="o">${</span><span class="nv">PCL_LIBRARY_DIRS</span><span class="o">}</span><span class="p">)</span>
<span class="linenos"> 7</span><span class="nb">add_definitions</span><span class="p">(</span><span class="o">${</span><span class="nv">PCL_DEFINITIONS</span><span class="o">}</span><span class="p">)</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="nb">add_executable</span> <span class="p">(</span><span class="s">ground_based_rgbd_people_detector</span><span class="w"> </span><span class="s">MACOSX_BUNDLE</span><span class="w"> </span><span class="s">src/main_ground_based_people_detection.cpp</span><span class="p">)</span>
<span class="linenos">10</span><span class="nb">target_link_libraries</span> <span class="p">(</span><span class="s">ground_based_rgbd_people_detector</span><span class="w"> </span><span class="o">${</span><span class="nv">PCL_LIBRARIES</span><span class="o">}</span><span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>After you have made the executable, you can run it. Simply do:</dt><dd><p>$ ./ground_based_rgbd_people_detector</p>
</dd>
</dl>
<p>The following images show some people detection results on a Kinect RGB-D stream.
The minimum and maximum height for people were set respectively to 1.3 and 2.3 meters, while the
minimum HOG confidence was set to -1.5.</p>
<a class="reference internal image-reference" href="_images/Screen3.jpg"><img alt="_images/Screen3.jpg" src="_images/Screen3.jpg" style="height: 300pt;" /></a>
<a class="reference internal image-reference" href="_images/Screen5.jpg"><img alt="_images/Screen5.jpg" src="_images/Screen5.jpg" style="height: 300pt;" /></a>
<a class="reference internal image-reference" href="_images/Screen8.jpg"><img alt="_images/Screen8.jpg" src="_images/Screen8.jpg" style="height: 300pt;" /></a>
<a class="reference internal image-reference" href="_images/Screen7.jpg"><img alt="_images/Screen7.jpg" src="_images/Screen7.jpg" style="height: 300pt;" /></a>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>