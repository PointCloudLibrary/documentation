<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Velodyne High Definition LiDAR (HDL) Grabber &mdash; Point Cloud Library 1.14.1-dev documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Point Cloud Library
          </a>
              <div class="version">
                1.14.1-dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">The Velodyne High Definition LiDAR (HDL) Grabber</a></li>
<li><a class="reference internal" href="#basic-network-setup">Basic Network Setup</a></li>
<li><a class="reference internal" href="#pcap-files">PCAP Files</a></li>
<li><a class="reference internal" href="#compiling-the-hdl-grabber-with-pcap-support">Compiling the HDL Grabber with PCAP support</a></li>
<li><a class="reference internal" href="#sample-program">Sample Program</a></li>
<li><a class="reference internal" href="#additional-details">Additional Details</a></li>
<li><a class="reference internal" href="#compiling-and-running-the-program">Compiling and running the program</a></li>
<li><a class="reference internal" href="#id1">Disabling Reverse Path Filter</a></li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Point Cloud Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>The Velodyne High Definition LiDAR (HDL) Grabber</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="the-velodyne-high-definition-lidar-hdl-grabber">
<span id="hdl-grabber"></span><h1>The Velodyne High Definition LiDAR (HDL) Grabber</h1>
<p>The Velodyne HDL is a network-based 3D LiDAR system that produces
360 degree point clouds containing over 700,000 points every second.</p>
<p>The HDL Grabber provided in PCL mimics other Grabbers, making it <em>almost</em>
plug-and-play.  Because the HDL devices are network based, however, there
are a few gotchas on some platforms.</p>
<p>The HDL Grabber supports the original HDL-64e as well as the HDL-32e.
More information on those sensors can be found at <a class="reference external" href="http://www.velodynelidar.com/">Velodyne’s Web Site</a></p>
</section>
<section id="basic-network-setup">
<h1>Basic Network Setup</h1>
<p>The Velodyne HDL uses network packets to provide range and intensity
data for each of the lasers in the device.  The HDL-64e consists of
64 lasers, while the HDL-32e consists of 32.</p>
<p>The HDL-64e and HDL-32e, by default, produce UDP network packets
on the 192.168.3 subnet.  Starting with the HDL-32e (Firmware Version 2),
the user can customize this network subnet.</p>
<p>The HDL can be connected either directly into your computer, or into a
network switch (to include a network switch with a built-in Wireless Access Point).
Regardless, one of your computer’s Network Interface Cards (NIC) [whether hard-wired
RJ-45 connection or wireless] needs to be configured to be on this 192.168.3 subnet.
Consult your operating system documentation on how to perform this.</p>
<p>In addition to the NIC settings, you may need to alter your operating system’s firewall rules.  The
HDL produces packets on port 2368 (by default).  The HDL-32e with Firmware Version 2
can be set to use a different port.  Consult your firewall documentation to open
this port in your firewall.</p>
<p>Lastly, modern Linux kernels have advanced network attack guards that go beyond basic firewall
rules.  The HDL-32e produces UDP packets that may be filtered by the OS using one of these
attack guards.  You will need to disable the <em>rp_filter</em> guard for the appropriate NIC.
For more information on how to disable this filter, please see the section below entitled
<a class="reference internal" href="#disabling-reverse-path-filter">Disabling Reverse Path Filter</a></p>
</section>
<section id="pcap-files">
<h1>PCAP Files</h1>
<p><a class="reference external" href="http://www.wireshark.org/">Wireshark</a> is a popular Network Packet Analyzer Program which
is available for most platforms, including Linux, MacOS and Windows.  This tool uses a defacto
standard network packet capture file format called <a class="reference external" href="https://en.wikipedia.org/wiki/Pcap">PCAP</a>.
Many publicly available Velodyne HDL packet captures use this PCAP file format as a means of
recording and playback.  These PCAP files can be used with the HDL Grabber if PCL is compiled with
PCAP support.</p>
<p>Velodyne provides sample PCAP files on their <a class="reference external" href="http://midas3.kitware.com/midas/community/29">website</a></p>
</section>
<section id="compiling-the-hdl-grabber-with-pcap-support">
<h1>Compiling the HDL Grabber with PCAP support</h1>
<p>On Linux, this involves installing libpcap-dev (Ubuntu) or libpcap-devel (Fedora).  CMake should
find the pcap libraries, and automatically configure PCL to use them.</p>
<p>On Windows, this involves installing both the <a class="reference external" href="http://www.winpcap.org/install/default.htm">WinPCAP installer</a>
and the <a class="reference external" href="http://www.winpcap.org/devel.htm">WinPCAP developer’s pack</a>.  You will also need to set an
environment variable <strong>PCAPDIR</strong> to the directory where you unzipped the developer’s pack.  Once that is
done, you should be able to run CMake again, and it should locate the appropriate files.</p>
<p>Note - You do not need to compile the HDL Grabber with support for PCAP.  It is <strong>only</strong> required if
you will be replaying PCAP files through the grabber.</p>
</section>
<section id="sample-program">
<h1>Sample Program</h1>
<p>In <em>visualization</em>, there is a very short piece of code which contains all that
is required to set up a <em>pcl::PointCloud&lt;XYZ&gt;</em>, <em>pcl::PointCloud&lt;XYZI&gt; or *pcl::PointCloud&lt;XYZRGB&gt;</em>
cloud callback.</p>
<p>Here is a screenshot of the PCL HDL Viewer in action, which uses the HDL Grabber.</p>
<a class="reference external image-reference" href="_images/pcl_hdl_viewer.png"><img alt="_images/pcl_hdl_viewer.png" src="_images/pcl_hdl_viewer.png" style="height: 390px;" /></a>
<p>So let’s look at the code. The following represents a simplified version of <em>tools/hdl_viewer_simple.cpp</em></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/point_cloud.h&gt;</span><span class="cp"></span>
<span class="linenos">  2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/point_types.h&gt;</span><span class="cp"></span>
<span class="linenos">  3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/io/hdl_grabber.h&gt;</span><span class="cp"></span>
<span class="linenos">  4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/visualization/point_cloud_color_handlers.h&gt;</span><span class="cp"></span>
<span class="linenos">  5</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/visualization/cloud_viewer.h&gt;</span><span class="cp"></span>
<span class="linenos">  6</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/console/parse.h&gt;</span><span class="cp"></span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="o">::</span><span class="nn">chrono_literals</span><span class="p">;</span><span class="w"></span>
<span class="linenos">  9</span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">pcl</span><span class="o">::</span><span class="nn">console</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 10</span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">pcl</span><span class="o">::</span><span class="nn">visualization</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 11</span>
<span class="linenos"> 12</span><span class="k">class</span><span class="w"> </span><span class="nc">SimpleHDLViewer</span><span class="w"></span>
<span class="linenos"> 13</span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 14</span><span class="w">  </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="linenos"> 15</span><span class="w">    </span><span class="k">typedef</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZI</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Cloud</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 16</span><span class="w">    </span><span class="k">typedef</span><span class="w"> </span><span class="n">Cloud</span><span class="o">::</span><span class="n">ConstPtr</span><span class="w"> </span><span class="n">CloudConstPtr</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span><span class="w">    </span><span class="n">SimpleHDLViewer</span><span class="w"> </span><span class="p">(</span><span class="n">pcl</span><span class="o">::</span><span class="n">Grabber</span><span class="o">&amp;</span><span class="w"> </span><span class="n">grabber</span><span class="p">,</span><span class="w"></span>
<span class="linenos"> 19</span><span class="w">        </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PointCloudColorHandler</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZI</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">handler</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"></span>
<span class="linenos"> 20</span><span class="w">        </span><span class="n">cloud_viewer_</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PCLVisualizer</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;PCL HDL Cloud&quot;</span><span class="p">)),</span><span class="w"></span>
<span class="linenos"> 21</span><span class="w">        </span><span class="n">grabber_</span><span class="w"> </span><span class="p">(</span><span class="n">grabber</span><span class="p">),</span><span class="w"></span>
<span class="linenos"> 22</span><span class="w">        </span><span class="n">handler_</span><span class="w"> </span><span class="p">(</span><span class="n">handler</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 23</span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 24</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">cloud_callback</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">CloudConstPtr</span><span class="o">&amp;</span><span class="w"> </span><span class="n">cloud</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 27</span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 28</span><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="p">(</span><span class="n">cloud_mutex_</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 29</span><span class="w">      </span><span class="n">cloud_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cloud</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 30</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">()</span><span class="w"></span>
<span class="linenos"> 33</span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 34</span><span class="w">      </span><span class="n">cloud_viewer_</span><span class="o">-&gt;</span><span class="n">addCoordinateSystem</span><span class="w"> </span><span class="p">(</span><span class="mf">3.0</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 35</span><span class="w">      </span><span class="n">cloud_viewer_</span><span class="o">-&gt;</span><span class="n">setBackgroundColor</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 36</span><span class="w">      </span><span class="n">cloud_viewer_</span><span class="o">-&gt;</span><span class="n">initCameraParameters</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="linenos"> 37</span><span class="w">      </span><span class="n">cloud_viewer_</span><span class="o">-&gt;</span><span class="n">setCameraPosition</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">30.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 38</span><span class="w">      </span><span class="n">cloud_viewer_</span><span class="o">-&gt;</span><span class="n">setCameraClipDistances</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">50.0</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">CloudConstPtr</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cloud_cb</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="linenos"> 41</span><span class="w">          </span><span class="p">[</span><span class="k">this</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">CloudConstPtr</span><span class="o">&amp;</span><span class="w"> </span><span class="n">cloud</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cloud_callback</span><span class="w"> </span><span class="p">(</span><span class="n">cloud</span><span class="p">);</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="linenos"> 42</span><span class="w">      </span><span class="n">boost</span><span class="o">::</span><span class="n">signals2</span><span class="o">::</span><span class="n">connection</span><span class="w"> </span><span class="n">cloud_connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grabber_</span><span class="p">.</span><span class="n">registerCallback</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="linenos"> 43</span><span class="w">          </span><span class="n">cloud_cb</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 44</span>
<span class="linenos"> 45</span><span class="w">      </span><span class="n">grabber_</span><span class="p">.</span><span class="n">start</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="linenos"> 46</span>
<span class="linenos"> 47</span><span class="w">      </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">cloud_viewer_</span><span class="o">-&gt;</span><span class="n">wasStopped</span><span class="w"> </span><span class="p">())</span><span class="w"></span>
<span class="linenos"> 48</span><span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 49</span><span class="w">        </span><span class="n">CloudConstPtr</span><span class="w"> </span><span class="n">cloud</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span><span class="w">        </span><span class="c1">// See if we can get a cloud</span>
<span class="linenos"> 52</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cloud_mutex_</span><span class="p">.</span><span class="n">try_lock</span><span class="w"> </span><span class="p">())</span><span class="w"></span>
<span class="linenos"> 53</span><span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 54</span><span class="w">          </span><span class="n">cloud_</span><span class="p">.</span><span class="n">swap</span><span class="w"> </span><span class="p">(</span><span class="n">cloud</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 55</span><span class="w">          </span><span class="n">cloud_mutex_</span><span class="p">.</span><span class="n">unlock</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="linenos"> 56</span><span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 57</span>
<span class="linenos"> 58</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 59</span><span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 60</span><span class="w">          </span><span class="n">handler_</span><span class="p">.</span><span class="n">setInputCloud</span><span class="w"> </span><span class="p">(</span><span class="n">cloud</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 61</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">cloud_viewer_</span><span class="o">-&gt;</span><span class="n">updatePointCloud</span><span class="w"> </span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span><span class="w"> </span><span class="n">handler_</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;HDL&quot;</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 62</span><span class="w">            </span><span class="n">cloud_viewer_</span><span class="o">-&gt;</span><span class="n">addPointCloud</span><span class="w"> </span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span><span class="w"> </span><span class="n">handler_</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;HDL&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span><span class="w">          </span><span class="n">cloud_viewer_</span><span class="o">-&gt;</span><span class="n">spinOnce</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="linenos"> 65</span><span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 66</span>
<span class="linenos"> 67</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">grabber_</span><span class="p">.</span><span class="n">isRunning</span><span class="w"> </span><span class="p">())</span><span class="w"></span>
<span class="linenos"> 68</span><span class="w">          </span><span class="n">cloud_viewer_</span><span class="o">-&gt;</span><span class="n">spin</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="linenos"> 69</span>
<span class="linenos"> 70</span><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="mi">100u</span><span class="n">s</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 71</span><span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 72</span>
<span class="linenos"> 73</span><span class="w">      </span><span class="n">grabber_</span><span class="p">.</span><span class="n">stop</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="linenos"> 74</span>
<span class="linenos"> 75</span><span class="w">      </span><span class="n">cloud_connection</span><span class="p">.</span><span class="n">disconnect</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="linenos"> 76</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 77</span>
<span class="linenos"> 78</span><span class="w">    </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PCLVisualizer</span><span class="o">::</span><span class="n">Ptr</span><span class="w"> </span><span class="n">cloud_viewer_</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 79</span>
<span class="linenos"> 80</span><span class="w">    </span><span class="n">pcl</span><span class="o">::</span><span class="n">Grabber</span><span class="o">&amp;</span><span class="w"> </span><span class="n">grabber_</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 81</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">cloud_mutex_</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 82</span>
<span class="linenos"> 83</span><span class="w">    </span><span class="n">CloudConstPtr</span><span class="w"> </span><span class="n">cloud_</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 84</span><span class="w">    </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PointCloudColorHandler</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZI</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">handler_</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 85</span><span class="p">};</span><span class="w"></span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 88</span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 89</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">hdlCalibration</span><span class="p">,</span><span class="w"> </span><span class="n">pcapFile</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 90</span>
<span class="linenos"> 91</span><span class="w">  </span><span class="n">parse_argument</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-calibrationFile&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">hdlCalibration</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 92</span><span class="w">  </span><span class="n">parse_argument</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-pcapFile&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pcapFile</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 93</span>
<span class="linenos"> 94</span><span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">HDLGrabber</span><span class="w"> </span><span class="n">grabber</span><span class="w"> </span><span class="p">(</span><span class="n">hdlCalibration</span><span class="p">,</span><span class="w"> </span><span class="n">pcapFile</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 95</span>
<span class="linenos"> 96</span><span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">PointCloudColorHandlerGenericField</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZI</span><span class="o">&gt;</span><span class="w"> </span><span class="n">color_handler</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;intensity&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span><span class="w">  </span><span class="n">SimpleHDLViewer</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">(</span><span class="n">grabber</span><span class="p">,</span><span class="w"> </span><span class="n">color_handler</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 99</span><span class="w">  </span><span class="n">v</span><span class="p">.</span><span class="n">run</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="linenos">100</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="linenos">101</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="additional-details">
<h1>Additional Details</h1>
<p>The <em>HDL Grabber</em> offers more than one datatype, which is the reason we made
the <em>Grabber</em> interface so generic, leading to the relatively complicated
lambda line. In fact, we can register the following callback types as of
this writing:</p>
<ul class="simple">
<li><p><cite>void (const pcl::PointCloud&lt;pcl::PointXYZRGB&gt;::ConstPtr&amp;)</cite></p></li>
</ul>
</section>
<section id="compiling-and-running-the-program">
<h1>Compiling and running the program</h1>
<p>Add the following lines to your CMakeLists.txt file:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">2.8</span><span class="w"> </span><span class="s">FATAL_ERROR</span><span class="p">)</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="nb">project</span><span class="p">(</span><span class="s">pcl_hdl_viewer_simple</span><span class="p">)</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="nb">find_package</span><span class="p">(</span><span class="s">PCL</span><span class="w"> </span><span class="s">1.2</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="nb">include_directories</span><span class="p">(</span><span class="o">${</span><span class="nv">PCL_INCLUDE_DIRS</span><span class="o">}</span><span class="p">)</span>
<span class="linenos"> 8</span><span class="nb">link_directories</span><span class="p">(</span><span class="o">${</span><span class="nv">PCL_LIBRARY_DIRS</span><span class="o">}</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="nb">add_definitions</span><span class="p">(</span><span class="o">${</span><span class="nv">PCL_DEFINITIONS</span><span class="o">}</span><span class="p">)</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="nb">add_executable</span><span class="p">(</span><span class="s">pcl_hdl_viewer_simple</span><span class="w"> </span><span class="s">hdl_viewer_simple.cpp</span><span class="p">)</span>
<span class="linenos">12</span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">pcl_hdl_viewer_simple</span><span class="w"> </span><span class="o">${</span><span class="nv">PCL_LIBRARIES</span><span class="o">}</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id1">
<h1><span class="target" id="disabling-reverse-path-filter">Disabling Reverse Path Filter</span></h1>
<p>First off, let’s understand what the <strong>Reverse Path Filter</strong> is all about.  A TCP or UDP packet
contains, amongst other information, a <strong>DESTINATION IP ADDRESS</strong> and a <strong>SOURCE IP ADDRESS</strong>.
The Destination IP Address represents where the packet will go.  In the case of a UDP packet, this
is usually the broadcast network IP Address (eg, 255.255.255.255 for a global broadcast, or
x.y.z.255 for a Class C Network [where x.y.z are the first three octets of a Class C network, such as
192.168.1]).</p>
<p>The Source IP Address, on the other hand, indicates where the packet originated from.  Packets
can be hand-crafted for spoofing-type attacks (eg, pretending to come from somewhere they really
didn’t). The Reverse Path Filter attempts to detect these instances.  The default rule that it uses is
that if a packet is received on Network Interface <em>A</em>, then if there is no <strong>route</strong> to the <strong>Source IP Address</strong>
on Network Interface <em>A</em>, then it will be dropped by the kernel.</p>
<p>So, what does this mean for the HDL-32e?  Well, by default, the Source IP Address is 192.168.X.Y, where
<strong>X</strong> and <strong>Y</strong> are the last 4 digits of the device’s serial number.  Remember, the default <em>Destination</em> IP
address for the HDL-32e is the 192.168.3 network.</p>
<p>If you have a single Network Interface, you will have a default route (that is a route to all other networks)
going out that single Network Interface.  To receive the HDL packets, that Network Interface will need to be
on the 192.168.3 subnet.  And all will be good because there is a route from your single Network Interface to
the <strong>packet’s Source IP Address</strong>, through your single Network Interface.</p>
<p>Ahh, but what happens when you have <em>two</em> Network Interfaces, for example, on to the <strong>internet</strong>, and one
dedicated to the HDL?  In that case, your primary NIC will have a default route to all other networks, but
the one that is dedicated to the HDL won’t.  By default, it won’t have a default route, and in fact,
it will only have a route to the 192.168.3 subnet.</p>
<p>That means that when the HDL packet is received by the Linux Kernel, it will determine that there is no route
from the secondary NIC back to the HDL packet Source IP Address, and drop the packet altogether.</p>
<p>The maddening thing about this is that if you were to run tcpdump or wireshark (two network packet sniffer programs),
you would see that the HDL packets were arriving at the NIC card!  The reason for this is that programs like
tcpdump and wireshark use something called <em>promiscuous mode</em> that allows them to receive all packets <strong>BEFORE</strong>
the Linux Kernel does.</p>
<p>So, there are a couple of solutions to this problem.  First, you could use a single NIC, and your computer will
be dedicated to the HDL.  You won’t have to do anything except change network IP addresses when you want to
connect to an alternate network.  For those that desire a second NIC, there are several options.  First, you
can set up a route back to the source network that traverses the second NIC.  Note, the Linux Kernel does not
actually try to connect back to the source network, it just ensures that there is a path to it.  This option
works well in practice.  The other option is to modify the RP Filter setting.  There are two possible modes -
turn it off completely, or relax the rules to see if there is a route back to that network via <em>any</em>
NIC on the computer.</p>
<p>Here are the options again for a multi-NIC system, with corresponding Linux Commands.</p>
<ol class="arabic simple">
<li><p>Add a route back to the HDL</p></li>
</ol>
<p>First off, let’s look at the interface settings for our two NICS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ifconfig
</pre></div>
</div>
<p>returns the following details (some items removed for brevity):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">em1</span><span class="p">:</span> <span class="n">flags</span><span class="o">=</span><span class="mi">4163</span><span class="o">&lt;</span><span class="n">UP</span><span class="p">,</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">RUNNING</span><span class="p">,</span><span class="n">MULTICAST</span><span class="o">&gt;</span>  <span class="n">mtu</span> <span class="mi">1500</span>
     <span class="n">inet</span> <span class="mf">192.168.128.108</span>  <span class="n">netmask</span> <span class="mf">255.255.255.0</span>  <span class="n">broadcast</span> <span class="mf">192.168.128.255</span>

<span class="n">eth0</span><span class="p">:</span> <span class="n">flags</span><span class="o">=</span><span class="mi">4163</span><span class="o">&lt;</span><span class="n">UP</span><span class="p">,</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">RUNNING</span><span class="p">,</span><span class="n">MULTICAST</span><span class="o">&gt;</span>  <span class="n">mtu</span> <span class="mi">1500</span>
     <span class="n">inet</span> <span class="mf">192.168.3.1</span>  <span class="n">netmask</span> <span class="mf">255.255.255.0</span>  <span class="n">broadcast</span> <span class="mf">192.168.3.255</span>
</pre></div>
</div>
<p>Next, let’s look at our routing table (again, some items removed for brevity):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ route -n

Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.128.1   0.0.0.0         UG    0      0        0 em1
192.168.3.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0
192.168.128.0   0.0.0.0         255.255.255.0   U     0      0        0 em1
</pre></div>
</div>
<p>To add a route to the HDL, assume that the HDL Source IP is 192.168.12.84.  You would use the
following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo route add -net 192.168.12.0/24 eth0
</pre></div>
</div>
<p>To verify that the route has been added, type the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ route -n

Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.128.1   0.0.0.0         UG    0      0        0 em1
192.168.3.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0
192.168.12.0    0.0.0.0         255.255.255.0   U     0      0        0 eth0
192.168.128.0   0.0.0.0         255.255.255.0   U     0      0        0 em1
</pre></div>
</div>
<p>Now, there is a route back to the source IP address of the HDL on the same interface
that the packet came from!</p>
<p>However, what if, for some reason (like you already use the 192.168.12 subnet on your computer or
network, and setting the route won’t work).  That’s what option #2 and #3 are for.</p>
<ol class="arabic simple" start="2">
<li><p>Relaxing the Reverse Path Filter</p></li>
</ol>
<p>TODO</p>
<ol class="arabic simple" start="3">
<li><p>Disabling the Reverse Path Filter</p></li>
</ol>
<p>TODO</p>
</section>
<section id="troubleshooting">
<h1>Troubleshooting</h1>
</section>
<section id="conclusion">
<h1>Conclusion</h1>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>