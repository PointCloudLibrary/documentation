<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Visualization of the NARF descriptor and descriptor distances &mdash; Point Cloud Library 1.14.1-dev documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Point Cloud Library
          </a>
              <div class="version">
                1.14.1-dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Visualization of the NARF descriptor and descriptor distances</a></li>
<li><a class="reference internal" href="#the-code">The code</a></li>
<li><a class="reference internal" href="#compiling-and-running-the-program">Compiling and running the program</a></li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Point Cloud Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Visualization of the NARF descriptor and descriptor distances</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="visualization-of-the-narf-descriptor-and-descriptor-distances">
<span id="narf-descriptor-visualization"></span><h1>Visualization of the NARF descriptor and descriptor distances</h1>
<p>This tutorial is about the visualization of how the NARF descriptor is
calculated and to test how the descriptor distances between certain points in a
range image behave. Compared to the other tuturials, this one is not really
about the code, but about trying the program and looking at the visualization.
Of course, nothing keeps you from having a look at it anyway.</p>
</section>
<section id="the-code">
<h1>The code</h1>
<p>First, create a file called, letâ€™s say, <code class="docutils literal notranslate"><span class="pre">narf_descriptor_visualization.cpp</span></code> in your favorite
editor, and place the following code inside it:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="cm">/* \author Bastian Steder */</span><span class="w"></span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="linenos">  4</span>
<span class="linenos">  5</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/point_cloud.h&gt;</span><span class="cp"></span>
<span class="linenos">  6</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/io/pcd_io.h&gt;</span><span class="cp"></span>
<span class="linenos">  7</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/visualization/range_image_visualizer.h&gt;</span><span class="cp"></span>
<span class="linenos">  8</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/range_image/range_image.h&gt;</span><span class="cp"></span>
<span class="linenos">  9</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/features/narf.h&gt;</span><span class="cp"></span>
<span class="linenos"> 10</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/console/parse.h&gt;</span><span class="cp"></span>
<span class="linenos"> 11</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pcl/common/file_io.h&gt;</span><span class="c1"> // for getFilenameWithoutExtension</span><span class="cp"></span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="kt">float</span><span class="w"> </span><span class="n">angular_resolution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 14</span><span class="kt">int</span><span class="w"> </span><span class="n">rotation_invariant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 15</span><span class="kt">float</span><span class="w"> </span><span class="n">support_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.3f</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 16</span><span class="kt">int</span><span class="w"> </span><span class="n">descriptor_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">36</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 17</span><span class="n">pcl</span><span class="o">::</span><span class="n">RangeImage</span><span class="o">::</span><span class="n">CoordinateFrame</span><span class="w"> </span><span class="n">coordinate_frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">RangeImage</span><span class="o">::</span><span class="n">CAMERA_FRAME</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 18</span><span class="kt">bool</span><span class="w"> </span><span class="n">setUnseenToMaxRange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 19</span>
<span class="linenos"> 20</span><span class="k">typedef</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZ</span><span class="w"> </span><span class="n">PointType</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 21</span>
<span class="linenos"> 22</span><span class="kt">void</span><span class="w"> </span>
<span class="linenos"> 23</span><span class="nf">printUsage</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">progName</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 24</span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 25</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">Usage: &quot;</span><span class="o">&lt;&lt;</span><span class="n">progName</span><span class="o">&lt;&lt;</span><span class="s">&quot; [options] &lt;scene.pcd&gt;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="linenos"> 26</span><span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Options:</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="linenos"> 27</span><span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;-------------------------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="linenos"> 28</span><span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;-r &lt;float&gt;   angular resolution in degrees (default &quot;</span><span class="o">&lt;&lt;</span><span class="n">angular_resolution</span><span class="o">&lt;&lt;</span><span class="s">&quot;)</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="linenos"> 29</span><span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;-s &lt;float&gt;   support size for the interest points (diameter of the used sphere - &quot;</span><span class="w"></span>
<span class="linenos"> 30</span><span class="w">            </span><span class="o">&lt;&lt;</span><span class="w">                                                     </span><span class="s">&quot;default &quot;</span><span class="o">&lt;&lt;</span><span class="n">support_size</span><span class="o">&lt;&lt;</span><span class="s">&quot;)</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="linenos"> 31</span><span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;-d &lt;int&gt;     descriptor size (default &quot;</span><span class="o">&lt;&lt;</span><span class="n">descriptor_size</span><span class="o">&lt;&lt;</span><span class="s">&quot;)</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="linenos"> 32</span><span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;-c &lt;int&gt;     coordinate frame of the input point cloud (default &quot;</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">coordinate_frame</span><span class="o">&lt;&lt;</span><span class="s">&quot;)</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="linenos"> 33</span><span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;-o &lt;0/1&gt;     switch rotational invariant version of the feature on/off&quot;</span><span class="w"></span>
<span class="linenos"> 34</span><span class="w">            </span><span class="o">&lt;&lt;</span><span class="w">               </span><span class="s">&quot; (default &quot;</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">rotation_invariant</span><span class="o">&lt;&lt;</span><span class="s">&quot;)</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="linenos"> 35</span><span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;-m           set unseen pixels to max range</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="linenos"> 36</span><span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;-h           this help</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="linenos"> 37</span><span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 38</span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span><span class="kt">int</span><span class="w"> </span>
<span class="linenos"> 41</span><span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 42</span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 43</span><span class="w">  </span><span class="c1">// --------------------------------------</span>
<span class="linenos"> 44</span><span class="w">  </span><span class="c1">// -----Parse Command Line Arguments-----</span>
<span class="linenos"> 45</span><span class="w">  </span><span class="c1">// --------------------------------------</span>
<span class="linenos"> 46</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">find_argument</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-h&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 47</span><span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 48</span><span class="w">    </span><span class="n">printUsage</span><span class="w"> </span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="linenos"> 49</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 50</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 51</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">find_argument</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-m&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 52</span><span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 53</span><span class="w">    </span><span class="n">setUnseenToMaxRange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 54</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Setting unseen values in range image to maximum range readings.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 55</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 56</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">parse</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-o&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">rotation_invariant</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 57</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Switching rotation invariant feature version &quot;</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">rotation_invariant</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;on&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;off&quot;</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="s">&quot;.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 58</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">tmp_coordinate_frame</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 59</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">parse</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">tmp_coordinate_frame</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 60</span><span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 61</span><span class="w">    </span><span class="n">coordinate_frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">RangeImage</span><span class="o">::</span><span class="n">CoordinateFrame</span><span class="w"> </span><span class="p">(</span><span class="n">tmp_coordinate_frame</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 62</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Using coordinate frame &quot;</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">coordinate_frame</span><span class="o">&lt;&lt;</span><span class="s">&quot;.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 63</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 64</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">parse</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">support_size</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 65</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Setting support size to &quot;</span><span class="o">&lt;&lt;</span><span class="n">support_size</span><span class="o">&lt;&lt;</span><span class="s">&quot;.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 66</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">parse</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">descriptor_size</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 67</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Setting descriptor size to &quot;</span><span class="o">&lt;&lt;</span><span class="n">descriptor_size</span><span class="o">&lt;&lt;</span><span class="s">&quot;.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 68</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">parse</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-r&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">angular_resolution</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 69</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Setting angular resolution to &quot;</span><span class="o">&lt;&lt;</span><span class="n">angular_resolution</span><span class="o">&lt;&lt;</span><span class="s">&quot;deg.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 70</span><span class="w">  </span><span class="n">angular_resolution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">deg2rad</span><span class="w"> </span><span class="p">(</span><span class="n">angular_resolution</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 71</span><span class="w">  </span>
<span class="linenos"> 72</span>
<span class="linenos"> 73</span><span class="w">  </span><span class="c1">// -----------------------</span>
<span class="linenos"> 74</span><span class="w">  </span><span class="c1">// -----Read pcd file-----</span>
<span class="linenos"> 75</span><span class="w">  </span><span class="c1">// -----------------------</span>
<span class="linenos"> 76</span><span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">PointType</span><span class="o">&gt;::</span><span class="n">Ptr</span><span class="w"> </span><span class="n">point_cloud_ptr</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">PointType</span><span class="o">&gt;</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 77</span><span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">PointType</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">point_cloud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">point_cloud_ptr</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 78</span><span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointWithViewpoint</span><span class="o">&gt;</span><span class="w"> </span><span class="n">far_ranges</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 79</span><span class="w">  </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Affine3f</span><span class="w"> </span><span class="n">scene_sensor_pose</span><span class="w"> </span><span class="p">(</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Affine3f</span><span class="o">::</span><span class="n">Identity</span><span class="w"> </span><span class="p">());</span><span class="w"></span>
<span class="linenos"> 80</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pcd_filename_indices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">parse_file_extension_argument</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;pcd&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 81</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">pcd_filename_indices</span><span class="p">.</span><span class="n">empty</span><span class="w"> </span><span class="p">())</span><span class="w"></span>
<span class="linenos"> 82</span><span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 83</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">pcd_filename_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span><span class="w"></span>
<span class="linenos"> 84</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pcl</span><span class="o">::</span><span class="n">io</span><span class="o">::</span><span class="n">loadPCDFile</span><span class="w"> </span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">point_cloud</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 85</span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 86</span><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Was not able to open file </span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="o">&lt;&lt;</span><span class="n">filename</span><span class="o">&lt;&lt;</span><span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 87</span><span class="w">      </span><span class="n">printUsage</span><span class="w"> </span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="linenos"> 88</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 89</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 90</span><span class="w">    </span><span class="n">scene_sensor_pose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Affine3f</span><span class="w"> </span><span class="p">(</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Translation3f</span><span class="w"> </span><span class="p">(</span><span class="n">point_cloud</span><span class="p">.</span><span class="n">sensor_origin_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"></span>
<span class="linenos"> 91</span><span class="w">                                                               </span><span class="n">point_cloud</span><span class="p">.</span><span class="n">sensor_origin_</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"></span>
<span class="linenos"> 92</span><span class="w">                                                               </span><span class="n">point_cloud</span><span class="p">.</span><span class="n">sensor_origin_</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span><span class="w"> </span><span class="o">*</span><span class="w"></span>
<span class="linenos"> 93</span><span class="w">                        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Affine3f</span><span class="w"> </span><span class="p">(</span><span class="n">point_cloud</span><span class="p">.</span><span class="n">sensor_orientation_</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 94</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">far_ranges_filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">getFilenameWithoutExtension</span><span class="w"> </span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;_far_ranges.pcd&quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 95</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pcl</span><span class="o">::</span><span class="n">io</span><span class="o">::</span><span class="n">loadPCDFile</span><span class="w"> </span><span class="p">(</span><span class="n">far_ranges_filename</span><span class="p">.</span><span class="n">c_str</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="n">far_ranges</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 96</span><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Far ranges file </span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="o">&lt;&lt;</span><span class="n">far_ranges_filename</span><span class="o">&lt;&lt;</span><span class="s">&quot;</span><span class="se">\&quot;</span><span class="s"> does not exists.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 97</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos"> 98</span><span class="w">  </span><span class="k">else</span><span class="w"></span>
<span class="linenos"> 99</span><span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="linenos">100</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">No *.pcd file for scene given.</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos">101</span><span class="w">    </span><span class="n">printUsage</span><span class="w"> </span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="linenos">102</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="linenos">103</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos">104</span><span class="w">  </span>
<span class="linenos">105</span><span class="w">  </span><span class="c1">// -----------------------------------------------</span>
<span class="linenos">106</span><span class="w">  </span><span class="c1">// -----Create RangeImage from the PointCloud-----</span>
<span class="linenos">107</span><span class="w">  </span><span class="c1">// -----------------------------------------------</span>
<span class="linenos">108</span><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">noise_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">109</span><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">min_range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span><span class="w"></span>
<span class="linenos">110</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">border_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="linenos">111</span><span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">RangeImage</span><span class="o">::</span><span class="n">Ptr</span><span class="w"> </span><span class="n">range_image_ptr</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">RangeImage</span><span class="p">);</span><span class="w"></span>
<span class="linenos">112</span><span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">RangeImage</span><span class="o">&amp;</span><span class="w"> </span><span class="n">range_image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">range_image_ptr</span><span class="p">;</span><span class="w"></span>
<span class="linenos">113</span><span class="w">  </span><span class="n">range_image</span><span class="p">.</span><span class="n">createFromPointCloud</span><span class="w"> </span><span class="p">(</span><span class="n">point_cloud</span><span class="p">,</span><span class="w"> </span><span class="n">angular_resolution</span><span class="p">,</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">deg2rad</span><span class="w"> </span><span class="p">(</span><span class="mf">360.0f</span><span class="p">),</span><span class="w"> </span><span class="n">pcl</span><span class="o">::</span><span class="n">deg2rad</span><span class="w"> </span><span class="p">(</span><span class="mf">180.0f</span><span class="p">),</span><span class="w"></span>
<span class="linenos">114</span><span class="w">                                   </span><span class="n">scene_sensor_pose</span><span class="p">,</span><span class="w"> </span><span class="n">coordinate_frame</span><span class="p">,</span><span class="w"> </span><span class="n">noise_level</span><span class="p">,</span><span class="w"> </span><span class="n">min_range</span><span class="p">,</span><span class="w"> </span><span class="n">border_size</span><span class="p">);</span><span class="w"></span>
<span class="linenos">115</span><span class="w">  </span><span class="n">range_image</span><span class="p">.</span><span class="n">integrateFarRanges</span><span class="w"> </span><span class="p">(</span><span class="n">far_ranges</span><span class="p">);</span><span class="w"></span>
<span class="linenos">116</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">setUnseenToMaxRange</span><span class="p">)</span><span class="w"></span>
<span class="linenos">117</span><span class="w">    </span><span class="n">range_image</span><span class="p">.</span><span class="n">setUnseenToMaxRange</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="linenos">118</span><span class="w">  </span>
<span class="linenos">119</span><span class="w">  </span><span class="c1">// Extract NARF features:</span>
<span class="linenos">120</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Now extracting NARFs in every image point.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos">121</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">Narf</span><span class="o">*&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">narfs</span><span class="p">;</span><span class="w"></span>
<span class="linenos">122</span><span class="w">  </span><span class="n">narfs</span><span class="p">.</span><span class="n">resize</span><span class="w"> </span><span class="p">(</span><span class="n">range_image</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="p">());</span><span class="w"></span>
<span class="linenos">123</span><span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">last_percentage</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">124</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="o">&lt;</span><span class="n">range_image</span><span class="p">.</span><span class="n">height</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">y</span><span class="p">)</span><span class="w"></span>
<span class="linenos">125</span><span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="linenos">126</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">&lt;</span><span class="n">range_image</span><span class="p">.</span><span class="n">width</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="linenos">127</span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos">128</span><span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="o">*</span><span class="n">range_image</span><span class="p">.</span><span class="n">width</span><span class="o">+</span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="linenos">129</span><span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">percentage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="mi">100</span><span class="o">*</span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">range_image</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="p">());</span><span class="w"></span>
<span class="linenos">130</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">percentage</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">last_percentage</span><span class="p">)</span><span class="w"></span>
<span class="linenos">131</span><span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="linenos">132</span><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">percentage</span><span class="o">&lt;&lt;</span><span class="s">&quot;% &quot;</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">flush</span><span class="p">;</span><span class="w"></span>
<span class="linenos">133</span><span class="w">        </span><span class="n">last_percentage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percentage</span><span class="p">;</span><span class="w"></span>
<span class="linenos">134</span><span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="linenos">135</span><span class="w">      </span><span class="n">pcl</span><span class="o">::</span><span class="n">Narf</span><span class="o">::</span><span class="n">extractFromRangeImageAndAddToList</span><span class="w"> </span><span class="p">(</span><span class="n">range_image</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">descriptor_size</span><span class="p">,</span><span class="w"></span>
<span class="linenos">136</span><span class="w">                                                    </span><span class="n">support_size</span><span class="p">,</span><span class="w"> </span><span class="n">rotation_invariant</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">narfs</span><span class="p">[</span><span class="n">index</span><span class="p">]);</span><span class="w"></span>
<span class="linenos">137</span><span class="w">      </span><span class="c1">//std::cout &lt;&lt; &quot;Extracted &quot;&lt;&lt;narfs[index].size ()&lt;&lt;&quot; features for pixel &quot;&lt;&lt;x&lt;&lt;&quot;,&quot;&lt;&lt;y&lt;&lt;&quot;.\n&quot;;</span>
<span class="linenos">138</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos">139</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos">140</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;100%</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos">141</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Done.</span><span class="se">\n\n</span><span class="s"> Now you can click on points in the image to visualize how the descriptor is &quot;</span><span class="w"></span>
<span class="linenos">142</span><span class="w">       </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;extracted and see the descriptor distances to every other point..</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos">143</span><span class="w">  </span>
<span class="linenos">144</span><span class="w">  </span><span class="c1">//---------------------</span>
<span class="linenos">145</span><span class="w">  </span><span class="c1">// -----Show image-----</span>
<span class="linenos">146</span><span class="w">  </span><span class="c1">// --------------------</span>
<span class="linenos">147</span><span class="w">  </span><span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">RangeImageVisualizer</span><span class="w"> </span><span class="n">range_image_widget</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Scene range image&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos">148</span><span class="w">                                           </span><span class="n">surface_patch_widget</span><span class="p">(</span><span class="s">&quot;Descriptor&#39;s surface patch&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos">149</span><span class="w">                                           </span><span class="n">descriptor_widget</span><span class="p">(</span><span class="s">&quot;Descriptor&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos">150</span><span class="w">                                           </span><span class="n">descriptor_distances_widget</span><span class="p">(</span><span class="s">&quot;descriptor distances&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">151</span><span class="w">  </span><span class="n">range_image_widget</span><span class="p">.</span><span class="n">showRangeImage</span><span class="w"> </span><span class="p">(</span><span class="n">range_image</span><span class="p">);</span><span class="w"></span>
<span class="linenos">152</span><span class="w">  </span><span class="c1">//range_image_widget.visualize_selected_point = true;</span>
<span class="linenos">153</span>
<span class="linenos">154</span><span class="w">  </span><span class="c1">//--------------------</span>
<span class="linenos">155</span><span class="w">  </span><span class="c1">// -----Main loop-----</span>
<span class="linenos">156</span><span class="w">  </span><span class="c1">//--------------------</span>
<span class="linenos">157</span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">158</span><span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="linenos">159</span><span class="w">    </span><span class="n">range_image_widget</span><span class="p">.</span><span class="n">spinOnce</span><span class="w"> </span><span class="p">();</span><span class="w">  </span><span class="c1">// process GUI events</span>
<span class="linenos">160</span><span class="w">    </span><span class="n">surface_patch_widget</span><span class="p">.</span><span class="n">spinOnce</span><span class="w"> </span><span class="p">();</span><span class="w">  </span><span class="c1">// process GUI events</span>
<span class="linenos">161</span><span class="w">    </span><span class="n">descriptor_widget</span><span class="p">.</span><span class="n">spinOnce</span><span class="w"> </span><span class="p">();</span><span class="w">  </span><span class="c1">// process GUI events</span>
<span class="linenos">162</span><span class="w">    </span><span class="n">pcl_sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">);</span><span class="w"></span>
<span class="linenos">163</span><span class="w">    </span>
<span class="linenos">164</span><span class="w">    </span><span class="c1">//if (!range_image_widget.mouse_click_happened)</span>
<span class="linenos">165</span><span class="w">      </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="linenos">166</span><span class="w">    </span><span class="c1">//range_image_widget.mouse_click_happened = false;</span>
<span class="linenos">167</span><span class="w">    </span><span class="c1">//float clicked_pixel_x_f = range_image_widget.last_clicked_point_x,</span>
<span class="linenos">168</span><span class="w">          </span><span class="c1">//clicked_pixel_y_f = range_image_widget.last_clicked_point_y;</span>
<span class="linenos">169</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">clicked_pixel_x</span><span class="p">,</span><span class="w"> </span><span class="n">clicked_pixel_y</span><span class="p">;</span><span class="w"></span>
<span class="linenos">170</span><span class="w">    </span><span class="c1">//range_image.real2DToInt2D (clicked_pixel_x_f, clicked_pixel_y_f, clicked_pixel_x, clicked_pixel_y);</span>
<span class="linenos">171</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">range_image</span><span class="p">.</span><span class="n">isValid</span><span class="w"> </span><span class="p">(</span><span class="n">clicked_pixel_x</span><span class="p">,</span><span class="w"> </span><span class="n">clicked_pixel_y</span><span class="p">))</span><span class="w"></span>
<span class="linenos">172</span><span class="w">      </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="linenos">173</span><span class="w">      </span><span class="c1">//Vector3f clicked_3d_point;</span>
<span class="linenos">174</span><span class="w">      </span><span class="c1">//range_image.getPoint (clicked_pixel_x, clicked_pixel_y, clicked_3d_point);</span>
<span class="linenos">175</span><span class="w">    </span>
<span class="linenos">176</span><span class="w">    </span><span class="c1">//surface_patch_widget.show (false);</span>
<span class="linenos">177</span><span class="w">    </span><span class="c1">//descriptor_widget.show (false);&quot;</span>
<span class="linenos">178</span><span class="w">    </span>
<span class="linenos">179</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">selected_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clicked_pixel_y</span><span class="o">*</span><span class="n">range_image</span><span class="p">.</span><span class="n">width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">clicked_pixel_x</span><span class="p">;</span><span class="w"></span>
<span class="linenos">180</span><span class="w">    </span><span class="n">pcl</span><span class="o">::</span><span class="n">Narf</span><span class="w"> </span><span class="n">narf</span><span class="p">;</span><span class="w"></span>
<span class="linenos">181</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">narf</span><span class="p">.</span><span class="n">extractFromRangeImage</span><span class="w"> </span><span class="p">(</span><span class="n">range_image</span><span class="p">,</span><span class="w"> </span><span class="n">clicked_pixel_x</span><span class="p">,</span><span class="w"> </span><span class="n">clicked_pixel_y</span><span class="p">,</span><span class="w"></span>
<span class="linenos">182</span><span class="w">                                                                         </span><span class="n">descriptor_size</span><span class="p">,</span><span class="w"> </span><span class="n">support_size</span><span class="p">))</span><span class="w"></span>
<span class="linenos">183</span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos">184</span><span class="w">      </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="linenos">185</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos">186</span><span class="w">    </span>
<span class="linenos">187</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">surface_patch_pixel_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">narf</span><span class="p">.</span><span class="n">getSurfacePatchPixelSize</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="linenos">188</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">surface_patch_world_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">narf</span><span class="p">.</span><span class="n">getSurfacePatchWorldSize</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="linenos">189</span><span class="w">    </span><span class="n">surface_patch_widget</span><span class="p">.</span><span class="n">showFloatImage</span><span class="w"> </span><span class="p">(</span><span class="n">narf</span><span class="p">.</span><span class="n">getSurfacePatch</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="n">surface_patch_pixel_size</span><span class="p">,</span><span class="w"> </span><span class="n">surface_patch_pixel_size</span><span class="p">,</span><span class="w"></span>
<span class="linenos">190</span><span class="w">                                         </span><span class="mf">-0.5f</span><span class="o">*</span><span class="n">surface_patch_world_size</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5f</span><span class="o">*</span><span class="n">surface_patch_world_size</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
<span class="linenos">191</span><span class="w">    </span><span class="cm">/*float surface_patch_rotation = narf.getSurfacePatchRotation ();</span>
<span class="linenos">192</span><span class="cm">    float patch_middle = 0.5f* (float (surface_patch_pixel_size-1));</span>
<span class="linenos">193</span><span class="cm">    float angle_step_size = pcl::deg2rad (360.0f)/narf.getDescriptorSize ();</span>
<span class="linenos">194</span><span class="cm">    float cell_size = surface_patch_world_size/float (surface_patch_pixel_size),</span>
<span class="linenos">195</span><span class="cm">          cell_factor = 1.0f/cell_size,</span>
<span class="linenos">196</span><span class="cm">          max_dist = 0.5f*surface_patch_world_size,</span>
<span class="linenos">197</span><span class="cm">          line_length = cell_factor* (max_dist-0.5f*cell_size);</span>
<span class="linenos">198</span><span class="cm">    for (int descriptor_value_idx=0; descriptor_value_idx&lt;narf.getDescriptorSize (); ++descriptor_value_idx)</span>
<span class="linenos">199</span><span class="cm">    {</span>
<span class="linenos">200</span><span class="cm">      float angle = descriptor_value_idx*angle_step_size + surface_patch_rotation;</span>
<span class="linenos">201</span><span class="cm">      //surface_patch_widget.markLine (patch_middle, patch_middle, patch_middle+line_length*sinf (angle),</span>
<span class="linenos">202</span><span class="cm">                                     //patch_middle+line_length*-std::cos (angle), pcl::visualization::Vector3ub (0,255,0));</span>
<span class="linenos">203</span><span class="cm">    }</span>
<span class="linenos">204</span><span class="cm">    std::vector&lt;float&gt; rotations, strengths;</span>
<span class="linenos">205</span><span class="cm">    narf.getRotations (rotations, strengths);</span>
<span class="linenos">206</span><span class="cm">    float radius = 0.5f*surface_patch_pixel_size;</span>
<span class="linenos">207</span><span class="cm">    for (unsigned int i=0; i&lt;rotations.size (); ++i)</span>
<span class="linenos">208</span><span class="cm">    {</span>
<span class="linenos">209</span><span class="cm">      //surface_patch_widget.markLine (radius-0.5, radius-0.5, radius-0.5f + 2.0f*radius*sinf (rotations[i]),</span>
<span class="linenos">210</span><span class="cm">                                                //radius-0.5f - 2.0f*radius*std::cos (rotations[i]), pcl::visualization::Vector3ub (255,0,0));</span>
<span class="linenos">211</span><span class="cm">    }*/</span><span class="w"></span>
<span class="linenos">212</span><span class="w">    </span>
<span class="linenos">213</span><span class="w">    </span><span class="n">descriptor_widget</span><span class="p">.</span><span class="n">showFloatImage</span><span class="w"> </span><span class="p">(</span><span class="n">narf</span><span class="p">.</span><span class="n">getDescriptor</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="n">narf</span><span class="p">.</span><span class="n">getDescriptorSize</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3f</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
<span class="linenos">214</span>
<span class="linenos">215</span><span class="w">    </span><span class="c1">//===================================</span>
<span class="linenos">216</span><span class="w">    </span><span class="c1">//=====Compare with all features=====</span>
<span class="linenos">217</span><span class="w">    </span><span class="c1">//===================================</span>
<span class="linenos">218</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">Narf</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">narfs_of_selected_point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">narfs</span><span class="p">[</span><span class="n">selected_index</span><span class="p">];</span><span class="w"></span>
<span class="linenos">219</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">narfs_of_selected_point</span><span class="p">.</span><span class="n">empty</span><span class="w"> </span><span class="p">())</span><span class="w"></span>
<span class="linenos">220</span><span class="w">      </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="linenos">221</span><span class="w">    </span>
<span class="linenos">222</span><span class="w">    </span><span class="c1">//descriptor_distances_widget.show (false);</span>
<span class="linenos">223</span><span class="w">    </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">descriptor_distance_image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">float</span><span class="p">[</span><span class="n">range_image</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="p">()];</span><span class="w"></span>
<span class="linenos">224</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">point_index</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">point_index</span><span class="o">&lt;</span><span class="n">range_image</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">point_index</span><span class="p">)</span><span class="w"></span>
<span class="linenos">225</span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos">226</span><span class="w">      </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">descriptor_distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">descriptor_distance_image</span><span class="p">[</span><span class="n">point_index</span><span class="p">];</span><span class="w"></span>
<span class="linenos">227</span><span class="w">      </span><span class="n">descriptor_distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;::</span><span class="n">infinity</span><span class="w"> </span><span class="p">();</span><span class="w"></span>
<span class="linenos">228</span><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">Narf</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">narfs_of_current_point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">narfs</span><span class="p">[</span><span class="n">point_index</span><span class="p">];</span><span class="w"></span>
<span class="linenos">229</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">narfs_of_current_point</span><span class="p">.</span><span class="n">empty</span><span class="w"> </span><span class="p">())</span><span class="w"></span>
<span class="linenos">230</span><span class="w">        </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="linenos">231</span><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">narfs_of_selected_point</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="linenos">232</span><span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="linenos">233</span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">&lt;</span><span class="n">narfs_of_current_point</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="linenos">234</span><span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="linenos">235</span><span class="w">          </span><span class="n">descriptor_distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">)(</span><span class="n">descriptor_distance</span><span class="p">,</span><span class="w"></span>
<span class="linenos">236</span><span class="w">                                           </span><span class="n">narfs_of_selected_point</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">getDescriptorDistance</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">narfs_of_current_point</span><span class="p">[</span><span class="n">j</span><span class="p">]));</span><span class="w"></span>
<span class="linenos">237</span><span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="linenos">238</span><span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="linenos">239</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos">240</span><span class="w">    </span><span class="n">descriptor_distances_widget</span><span class="p">.</span><span class="n">showFloatImage</span><span class="w"> </span><span class="p">(</span><span class="n">descriptor_distance_image</span><span class="p">,</span><span class="w"> </span><span class="n">range_image</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">range_image</span><span class="p">.</span><span class="n">height</span><span class="p">,</span><span class="w"></span>
<span class="linenos">241</span><span class="w">                                               </span><span class="o">-</span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;::</span><span class="n">infinity</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;::</span><span class="n">infinity</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
<span class="linenos">242</span><span class="w">    </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">descriptor_distance_image</span><span class="p">;</span><span class="w"></span>
<span class="linenos">243</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos">244</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="compiling-and-running-the-program">
<h1>Compiling and running the program</h1>
<p>Add the following lines to your CMakeLists.txt file:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.5</span><span class="w"> </span><span class="s">FATAL_ERROR</span><span class="p">)</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="nb">project</span><span class="p">(</span><span class="s">narf_descriptor_visualization</span><span class="p">)</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="nb">find_package</span><span class="p">(</span><span class="s">PCL</span><span class="w"> </span><span class="s">1.3</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="nb">include_directories</span><span class="p">(</span><span class="o">${</span><span class="nv">PCL_INCLUDE_DIRS</span><span class="o">}</span><span class="p">)</span>
<span class="linenos"> 8</span><span class="nb">link_directories</span><span class="p">(</span><span class="o">${</span><span class="nv">PCL_LIBRARY_DIRS</span><span class="o">}</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="nb">add_definitions</span><span class="p">(</span><span class="o">${</span><span class="nv">PCL_DEFINITIONS</span><span class="o">}</span><span class="p">)</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="nb">add_executable</span> <span class="p">(</span><span class="s">narf_descriptor_visualization</span><span class="w"> </span><span class="s">narf_descriptor_visualization.cpp</span><span class="p">)</span>
<span class="linenos">12</span><span class="nb">target_link_libraries</span> <span class="p">(</span><span class="s">narf_descriptor_visualization</span><span class="w"> </span><span class="o">${</span><span class="nv">PCL_LIBRARIES</span><span class="o">}</span><span class="p">)</span>
</pre></div>
</div>
<p>You can now try it with a point cloud file from your hard drive:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./narf_descriptor_visualization &lt;point_cloud.pcd&gt;
</pre></div>
</div>
<p>It will take a few second, during which you will see the status in the
terminal. During this time, a NARF feature is extracted in every point of the
range image created from the given point cloud. When it is done, a widget
showing the range image pops up. Now click on a point in the range image. If it
is a valid image point, three additional widgets will pop up. One visualizing
the actual descriptor as a row of gray values, one showing a local range image
patch of the area on which you clicked, overlaid with a star shaped pattern.
Each beam corresponds to one of the cells in the descriptor. The one facing
upwards to the first cell and then going clockwise. The basic intuition is,
that the more the surface changes under the beam, the higher (brighter) the
value of the corresponding descriptor cell. There is also one or more red
beams, which mark the extracted dominant orientations of the image patch,
which, together with the normal, is used to create a unique orientation for the
feature coordinate frame. The last image visualizes the descriptor distances to
every other point in the scene. The darker the value, the more similar the
point is to the clicked image point.</p>
<p>The result should look similar to this:</p>
<img alt="_images/narf_descriptor_visualization.png" src="_images/narf_descriptor_visualization.png" />
<p>Also have a look at:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./narf_descriptor_visualization -h
</pre></div>
</div>
<p>for a list of parameters.</p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>